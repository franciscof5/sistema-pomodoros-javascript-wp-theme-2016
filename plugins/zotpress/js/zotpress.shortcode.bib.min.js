jQuery(document).ready(function(){function s(t,e,c,z,d){void 0!==t&&"false"!=t&&""!=t||(t=0),void 0!==e&&"false"!=e&&""!=e||(e=0),jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",instance_id:c.attr("id"),api_user_id:jQuery(".ZP_API_USER_ID",c).text(),item_type:jQuery(".ZP_ITEM_TYPE",c).text(),item_key:z.zpItemkey,itemtype:z.zpItemType,collection_id:z.zpCollectionId,tag_id:z.zpTagId,author:z.zpAuthor,year:z.zpYear,style:z.zpStyle,limit:z.zpLimit,title:z.zpTitle,showimage:z.zpShowImages,showtags:z.zpShowTags,downloadable:z.zpDownloadable,inclusive:z.zpInclusive,shownotes:z.zpShowNotes,showabstracts:z.zpShowAbstracts,citeable:z.zpCiteable,target:z.zpTarget,urlwrap:z.zpURLWrap,highlight:z.zpHighlight,sortby:jQuery(".ZP_SORTBY",c).text(),order:jQuery(".ZP_ORDER",c).text(),update:d,request_start:t,request_last:e,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(t){var e,o,u,l=jQuery.parseJSON(t);"empty"==l.status?(e="There was a Zotpress error: ",0==l.data?(l.data="No items found.",e=l.data):e+=l.data,console.log(e),t="",0<jQuery("#"+l.instance+" .zp-List .zp-Entry").length&&(t=' class="hide"'),jQuery("#"+l.instance+" .zp-List").removeClass("loading").append("<p"+t+">"+e+"</p>")):(jQuery("#"+l.instance+" .zp-SEO-Content").remove(),void 0!==l&&null!=l&&0!=l&&0<l.data.length?(o="",1==z.zpShowNotes&&(u=""),!1===d?jQuery("#"+l.instance+" .zp-List").addClass("used_cache"):!0===d&&(!jQuery("#"+l.instance+" .zp-List").hasClass("updating")&&0<jQuery("#"+l.instance+" .zp-Citation-Notes").length&&jQuery("#"+l.instance+" .zp-Citation-Notes").remove(),jQuery("#"+l.instance+" .zp-List").hasClass("updating")||jQuery("#"+l.instance+" .zp-List").addClass("updating"),z.zpForceNumsCount=1),jQuery.each(l.data,function(t,a){var r="",e=jQuery("#"+l.instance+" .zp-List #zp-ID-"+jQuery(".ZP_POSTID",c).text()+"-"+jQuery(".ZP_API_USER_ID",c).text()+"-"+a.key);if(0<e.length&&!1===d&&!jQuery("#"+l.instance+" .zp-List").hasClass("used_cache"))return!1;var n="none";a.data.hasOwnProperty("itemType")&&(n=a.data.itemType);var i="0000",s="0000";a.meta.hasOwnProperty("parsedDate")&&(i=a.meta.parsedDate.substring(0,4),s=a.meta.parsedDate);var p=a.data.title;a.meta.hasOwnProperty("creatorSummary")&&(p=a.meta.creatorSummary.replace(/ /g,"-")),r+="<div id='zp-ID-"+jQuery(".ZP_POSTID",c).text()+"-"+jQuery(".ZP_API_USER_ID",c).text()+"-"+a.key+"'",r+=" data-zp-author-date='"+p+"-"+s+"'",r+=" data-zp-date-author='"+s+"-"+p+"'",r+=" data-zp-date='"+s+"'",r+=" data-zp-year='"+i+"'",r+=" data-zp-itemtype='"+n+"'",r+=" class='zp-Entry zpSearchResultsItem",!0===d&&(r+=" zp_updated"),0<jQuery("#"+l.instance+" .ZP_SHOWIMAGE").text().trim().length&&a.hasOwnProperty("image")?(r+=" zp-HasImage'>\n",r+="<div id='zp-Citation-"+a.key+"' class='zp-Entry-Image hasImage' rel='"+a.key+"'>\n","image"==z.zpURLWrap&&""!=a.data.url&&(r+="<a href='"+a.data.url+"'",z.zpTarget&&(r+=" target='_blank'"),r+=">"),r+="<img class='thumb' src='"+a.image[0]+"' alt='image' />\n","image"==z.zpURLWrap&&""!=a.data.url&&(r+="</a>"),r+="</div>\n"):r+="'>\n",0<jQuery("#"+l.instance+" .ZP_FORCENUM").text().length&&"1"==jQuery("#"+l.instance+" .ZP_FORCENUM").text()&&(/csl-left-margin/i.test(a.bib)||(a.bib=a.bib.replace('<div class="csl-entry">','<div class="csl-entry">'+z.zpForceNumsCount+". "),z.zpForceNumsCount++)),r+=a.bib,1==z.zpShowAbstracts&&a.data.hasOwnProperty("abstractNote")&&0<a.data.abstractNote.length&&(r+="<p class='zp-Abstract'><span class='zp-Abstract-Title'>Abstract:</span> "+a.data.abstractNote+"</p>\n"),1==z.zpShowTags&&a.data.hasOwnProperty("tags")&&0<a.data.tags.length&&(r+="<p class='zp-Zotpress-ShowTags'><span class='title'>Tags:</span> ",jQuery.each(a.data.tags,function(t,e){r+="<span class='tag'>"+e.tag+"</span>",t!=a.data.tags.length-1&&(r+="<span class='separator'>,</span> ")}),r+="</p>\n"),r+="</div>\n",1==z.zpShowNotes&&a.hasOwnProperty("notes")&&(u+=a.notes),0<e.length&&!0===d?e.replaceWith(jQuery(r)):o+=r}),!1===d&&jQuery("#"+l.instance+" .zp-List").append(o),1==z.zpShowNotes&&0<u.length&&(u="<div class='zp-Citation-Notes'>\n<h4>Notes</h4>\n<ol>\n"+u,u+="</ol>\n</div>\x3c!-- .zp-Citation-Notes --\x3e\n\n",jQuery("#"+l.instance).append(u)),0<jQuery("#"+l.instance+" .zp-List .csl-left-margin").length&&0<jQuery(".ZP_STYLE",c).text().trim().length&&"american-antiquity"!=jQuery(".ZP_STYLE",c).text().trim()&&(z.zpForceNumsCount=1,jQuery("#"+l.instance+" .zp-List .csl-left-margin").each(function(t,e){var a=(a=jQuery(e).text()).replace(a.match(/\d+/)[0],z.zpForceNumsCount);jQuery(e).text(a),z.zpForceNumsCount++})),a(c,l,z),0!=l.meta.request_next&&"false"!=l.meta.request_next?s(l.meta.request_next,l.meta.request_last,c,z,d):(jQuery("#"+l.instance+" .zp-List").removeClass("loading"),jQuery("#"+l.instance+" .zp-List").hasClass("updating")?a(c,l,z):s(0,0,c,z,!0))):!0===d&&(jQuery("#"+c.attr("id")+" .zp-List").removeClass("loading"),0==jQuery("#"+c.attr("id")+" .zp-List .zp-Entry").length&&jQuery("#"+c.attr("id")+" .zp-List").append("<p>There are no citations to display.</p>\n")))},error:function(t){console.log("Zotpress via WP AJAX Error: ",t)}})}function a(n,t,i){var e,a,r,s,p,o,u=jQuery(".ZP_SORTBY",n).text(),l=jQuery(".ZP_ORDER",n).text();e=t,a="date"==u?"data-zp-date-author":"data-zp-author-date",r=l,-1!==["author","date"].indexOf(u)&&0==jQuery("#"+e.instance+" .zp-List .csl-left-margin").length&&jQuery("#"+e.instance+" .zp-List div.zp-Entry").sort(function(t,e){t=t.getAttribute(a).toLowerCase(),e=e.getAttribute(a).toLowerCase();return e<t?"asc"==r?1:-1:t<e?"asc"==r?-1:1:0}).detach().appendTo("#"+e.instance+" .zp-List"),!1!==i.zpTitle&&(s={},jQuery("#"+t.instance+" .zp-List div.zp-Entry").each(function(t,e){var a=jQuery(e).data("zp-"+i.zpTitle);!1===s.hasOwnProperty(a)&&(s[a]=[]),s[a].push(jQuery(e).attr("id"))}),p=Object.getOwnPropertyNames(s),"itemtype"==i.zpTitle?((o=["book","bookSection","journalArticle","conferencePaper","thesis","report","encyclopediaArticle","newspaperArticle","magazineArticle","presentation","interview","dictionaryEntry","document","manuscript","patent","map","blogPost","webpage","artwork","film","audioRecording","statute","bill","case","hearing","forumPost","letter","email","instantMessage","software","podcast","radioBroadcast","tvBroadcast","videoRecording","attachment","note"]).slice(0).forEach(function(t,e){-1==p.indexOf(t)&&o.splice(o.indexOf(t),1)}),p=o):"asc"==l?p.sort(function(t,e){return t-e}):p.sort(function(t,e){return e-t}),p.forEach(function(a,t){var e,r=a;"itemtype"==i.zpTitle&&(null!==r.match(/[A-Z]/)&&(e=r.match(/[A-Z]/).index,r=r.substr(0,e)+" "+r.substr(e)),r=r.charAt(0).toUpperCase()+r.slice(1)),"0000"==r&&(r="No date"),i.zpTitle,0==jQuery("#"+n.attr("id")+" .zp-List h3[rel='"+a+"']").length&&jQuery("#"+n.attr("id")+" .zp-List").append("<h3 rel='"+a+"'>"+r+"</h3>\n"),("year"==i.zpTitle&&"asc"==l||"itemtype"==i.zpTitle&&"date"==u)&&s[a].reverse(),s[a].forEach(function(t,e){jQuery("#"+n.attr("id")+" #"+t).insertAfter(jQuery("#"+n.attr("id")+" .zp-List h3[rel='"+a+"']"))})}))}0<jQuery(".zp-Zotpress-Bib").length&&jQuery(".zp-Zotpress-Bib").each(function(t,e){var a,r,n=jQuery(e),i={zpItemkey:!1};0<jQuery(".ZP_ITEM_KEY",n).text().trim().length&&(i.zpItemkey=jQuery(".ZP_ITEM_KEY",n).text()),i.zpItemType=!1,0<jQuery(".ZP_ITEMTYPE",n).text().trim().length&&(i.zpItemType=jQuery(".ZP_ITEMTYPE",n).text()),i.zpCollectionId=!1,0<jQuery(".ZP_COLLECTION_ID",n).text().trim().length&&(i.zpCollectionId=jQuery(".ZP_COLLECTION_ID",n).text()),i.zpTagId=!1,0<jQuery(".ZP_TAG_ID",n).text().trim().length&&(i.zpTagId=jQuery(".ZP_TAG_ID",n).text()),i.zpAuthor=!1,0<jQuery(".ZP_AUTHOR",n).text().trim().length&&(i.zpAuthor=jQuery(".ZP_AUTHOR",n).text()),i.zpYear=!1,0<jQuery(".ZP_YEAR",n).text().trim().length&&(i.zpYear=jQuery(".ZP_YEAR",n).text()),i.zpStyle=!1,0<jQuery(".ZP_STYLE",n).text().trim().length&&(i.zpStyle=jQuery(".ZP_STYLE",n).text()),i.zpLimit=!1,0<jQuery(".ZP_LIMIT",n).text().trim().length&&(i.zpLimit=jQuery(".ZP_LIMIT",n).text()),i.zpTitle=!1,0<jQuery(".ZP_TITLE",n).text().trim().length&&(i.zpTitle=jQuery(".ZP_TITLE",n).text()),i.zpShowImages=!1,0<jQuery(".ZP_SHOWIMAGE",n).text().trim().length&&(i.zpShowImages=jQuery(".ZP_SHOWIMAGE",n).text().trim()),i.zpShowTags=!1,0<jQuery(".ZP_SHOWTAGS",n).text().trim().length&&(i.zpShowTags=!0),i.zpDownloadable=!1,0<jQuery(".ZP_DOWNLOADABLE",n).text().trim().length&&(i.zpDownloadable=!0),i.zpInclusive=!1,0<jQuery(".ZP_INCLUSIVE",n).text().trim().length&&(i.zpInclusive=!0),i.zpShowNotes=!1,0<jQuery(".ZP_NOTES",n).text().trim().length&&(i.zpShowNotes=!0),i.zpShowAbstracts=!1,0<jQuery(".ZP_ABSTRACT",n).text().trim().length&&(i.zpShowAbstracts=!0),i.zpCiteable=!1,0<jQuery(".ZP_CITEABLE",n).text().trim().length&&(i.zpCiteable=!0),i.zpTarget=!1,0<jQuery(".ZP_TARGET",n).text().trim().length&&(i.zpTarget=!0),i.zpURLWrap=!1,0<jQuery(".ZP_URLWRAP",n).text().trim().length&&(i.zpURLWrap=jQuery(".ZP_URLWRAP",n).text()),i.zpHighlight=!1,0<jQuery(".ZP_HIGHLIGHT",n).text().trim().length&&(i.zpHighlight=jQuery(".ZP_HIGHLIGHT",n).text()),i.zpForceNumsCount=1,i.zpCollectionId&&-1!=i.zpCollectionId.indexOf(",")?(a=i.zpCollectionId.split(","),jQuery.each(a,function(t,e){i.zpCollectionId=e,s(0,0,n,i,!1)})):i.zpTagId&&1==i.zpInclusive&&-1!=i.zpTagId.indexOf(",")?(a=i.zpTagId.split(","),jQuery.each(a,function(t,e){i.zpTagId=e,s(0,0,n,i,!1)})):i.zpAuthor&&-1!=i.zpAuthor.indexOf(",")?(r=i.zpAuthor.split(","),1==i.zpInclusive?jQuery.each(r,function(t,e){i.zpAuthor=e,s(0,0,n,i,!1)}):s(0,0,n,i,!1)):i.zpYear&&-1!=i.zpYear.indexOf(",")?(r=i.zpYear.split(","),jQuery.each(r,function(t,e){i.zpYear=e,s(0,0,n,i,!1)})):s(0,0,n,i,!1)})});
